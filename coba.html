<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday!</title>
    
    <!-- Tailwind CSS for rapid, responsive styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts for the pixelated aesthetic -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons for modern, clean icons (vanilla JS version) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Custom styles to match the retro theme */
        :root {
            /* UPDATED: Changed colors to a Nightwing theme */
            --hot-pink: #00529B; /* Nightwing Blue */
            --lime-green: #EAEAEA; /* Light Gray/White */
            --dark-purple: #1e0f33;
            --dark-blue: #0d0d2b;
            --glow-color: rgba(0, 115, 207, 0.6); /* Blue Glow */
            --green-glow-color: rgba(234, 234, 234, 0.5); /* White Glow */
        }

        body {
            font-family: 'Press Start 2P', cursive;
            color: white;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 1rem;
            /* UPDATED: Set a single Nightwing image as the full-page background */
            background-image: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('https://images.alphacoders.com/133/1338347.jpeg');
            background-size: cover;
            background-position: center center;
            background-repeat: no-repeat;
            cursor: none;
        }

        /* UPDATED: Nightwing cursor styles */
        #heart-cursor {
            position: fixed;
            width: 30px;
            height: 30px;
            pointer-events: none;
            z-index: 9999;
            transform: translate(-50%, -50%);
        }

        #heart-cursor svg {
            width: 100%;
            height: 100%;
            fill: var(--hot-pink);
            filter: drop-shadow(0 0 5px var(--glow-color));
        }
        
        /* The main device container */
        #device {
            background-color: var(--hot-pink);
            border: 4px solid #007FFF;
            border-radius: 40px;
            width: 100%;
            max-width: 420px;
            height: 90vh;
            max-height: 850px;
            box-shadow: 0 0 40px var(--glow-color), inset 0 0 15px rgba(255, 255, 255, 0.3);
            display: flex;
            flex-direction: column;
            padding: 20px;
            transition: all 0.3s ease;
        }

        /* The screen of the device */
        #screen {
            background-color: #000;
            border: 3px solid #333;
            border-radius: 20px;
            flex-grow: 1;
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        
        /* General styling for each "app" window */
        .app-window {
            background-color: #0c0c0c;
            display: flex;
            flex-direction: column;
            height: 100%;
            animation: fadeIn 0.5s ease;
        }
        
        /* Title bar for each app window */
        .title-bar {
            background-color: #222;
            padding: 6px 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 2px solid var(--lime-green);
            flex-shrink: 0;
            user-select: none;
        }
        
        .title-bar-text {
            color: var(--lime-green);
            font-size: 0.7rem;
            text-shadow: 0 0 5px var(--green-glow-color);
        }

        .title-bar-dots {
            display: flex;
            gap: 5px;
        }
        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        .dot-red { background-color: #ff5f56; }
        .dot-yellow { background-color: #ffbd2e; }
        .dot-green { background-color: #27c93f; }

        /* General button styling */
        .pixel-button {
            background-color: var(--lime-green);
            color: #000;
            border: none;
            padding: 10px 15px;
            font-family: 'Press Start 2P', cursive;
            cursor: none; /* Make buttons also use the custom cursor */
            box-shadow: 0 4px 0 #8c8c8c;
            transition: all 0.1s ease-in-out;
            text-shadow: none;
        }
        .pixel-button:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #8c8c8c;
        }
        
        /* Bottom navigation bar */
        #bottom-nav {
            display: flex;
            justify-content: space-around;
            background-color: #1a1a1a;
            padding: 10px 0;
            border-top: 2px solid var(--hot-pink);
            flex-shrink: 0;
            box-shadow: 0 -5px 15px var(--glow-color);
        }
        .nav-icon {
            color: #aaa;
            cursor: none; /* Make icons also use the custom cursor */
            transition: all 0.2s ease;
        }
        .nav-icon.active, .nav-icon:hover {
            color: var(--hot-pink);
            transform: scale(1.1);
        }

        /* Typewriter cursor effect */
        .cursor::after {
            content: '_';
            animation: blink 1s step-end infinite;
        }

        /* Music Playlist Styles */
        #music-playlist-overlay {
            transition: opacity 0.3s ease-in-out;
        }
        #music-playlist-list li:hover {
            background-color: var(--hot-pink);
        }
        #music-playlist-list li.active {
            color: var(--lime-green);
            font-weight: bold;
        }
        #music-playlist-list li .artist {
            font-size: 0.7rem;
            color: #aaa;
        }
        
        @keyframes blink {
            50% { opacity: 0; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        
        /* Scrollbar styling for a retro feel */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #222;
        }
        ::-webkit-scrollbar-thumb {
            background: var(--lime-green);
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #ffffff;
        }

    </style>
</head>
<body class="bg-gray-900 text-white">
    
    <!-- UPDATED: Nightwing logo cursor -->
    <div id="heart-cursor">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" fill="currentColor"><path d="M247.31,128c0,66-103.31,119-119.31,119S9,194,9,128,128,9,128,9,247.31,62,247.31,128Z"/></svg>
    </div>


    <!-- The main "device" that holds the entire experience -->
    <div id="device">
        <div id="screen">
            
            <!-- ====== 1. UNLOCK SCREEN (Initial View) - REFACTORED FOR CENTERING ====== -->
            <div id="unlock-screen" class="app-window flex flex-col p-6 bg-cover bg-center" style="background-image: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('./nightwing.jpg');">
                <!-- Top section -->
                <div class="text-center">
                    <h1 id="unlock-title" class="text-2xl md:text-3xl text-white font-bold mb-2" style="text-shadow: 0 0 10px var(--glow-color);">Message For You</h1>
                    <p id="unlock-recipient" class="text-lg text-gray-300">...</p>
                </div>
                
                <!-- Middle section that grows to push other content to top/bottom -->
                <div class="flex-grow flex flex-col items-center justify-center">
                    <div class="text-center">
                        <p id="unlock-date" class="text-sm text-gray-400 mb-6">September 7, 2025</p>
                        <button id="open-button" class="pixel-button text-xl rounded-md flex items-center gap-2">
                            <i data-lucide="mail-open"></i>
                            OPEN
                        </button>
                    </div>
                </div>

                <!-- Bottom section -->
                 <div class="w-full text-center">
                    <p class="text-xs text-gray-500">From: <span id="unlock-sender"></span></p>
                </div>
            </div>

            <!-- ====== MAIN CONTENT WRAPPER (Initially Hidden) ====== -->
            <div id="main-content" class="hidden h-full flex-col">
                <div class="flex-grow overflow-y-auto">

                    <!-- ====== 2. NOTES APP ====== -->
                    <div id="app-notes" class="app-window">
                        <div class="title-bar">
                            <div class="title-bar-dots">
                                <div class="dot dot-red"></div>
                                <div class="dot dot-yellow"></div>
                                <div class="dot dot-green"></div>
                            </div>
                            <span class="title-bar-text">BIRTHDAY_WISH.TXT</span>
                            <i data-lucide="chevrons-left" class="text-lime-400 w-4 h-4"></i>
                        </div>
                        <div id="notes-content" class="p-4 text-lime-400 text-sm md:text-base leading-relaxed overflow-y-auto flex-grow h-0">
                           <!-- JS will populate this with a typewriter effect -->
                        </div>
                        <div class="p-2 border-t-2 border-lime-400 flex justify-center gap-2">
                            <!-- GEMINI API: Listen and Rewrite buttons added -->
                            <button id="listen-notes-button" class="pixel-button rounded-sm text-sm flex items-center gap-1">✨ LISTEN</button>
                            <button id="rewrite-notes-button" class="pixel-button rounded-sm text-sm flex items-center gap-1">✨ REWRITE</button>
                        </div>
                    </div>
                    
                    <!-- ====== 3. MESSAGE APP ====== -->
                    <div id="app-message" class="app-window hidden">
                         <div class="title-bar">
                            <div class="title-bar-dots">
                                <div class="dot dot-red"></div>
                                <div class="dot dot-yellow"></div>
                                <div class="dot dot-green"></div>
                            </div>
                            <span class="title-bar-text">ChatterBox</span>
                            <i data-lucide="message-square" class="text-lime-400 w-4 h-4"></i>
                        </div>
                        <div id="message-list" class="flex flex-col flex-grow p-3 space-y-4 overflow-y-auto h-0">
                            <!-- Messages will be added here by JS -->
                        </div>
                        <div class="p-2 border-t-2 border-lime-400">
                           <div class="bg-gray-800 border border-lime-400 rounded-md flex items-center p-1">
                                <input type="text" id="chat-input" placeholder="Initializing chat..." disabled class="bg-transparent w-full text-lime-400 text-sm focus:outline-none px-2">
                                <button id="chat-send-button" class="pixel-button rounded-sm text-sm py-1 px-3" disabled>
                                    <i data-lucide="send-horizontal" class="w-4 h-4"></i>
                                </button>
                           </div>
                        </div>
                    </div>
                    
                    <!-- ====== 4. GALLERY APP (UPDATED) ====== -->
                    <div id="app-gallery" class="app-window hidden">
                        <div class="title-bar">
                            <div class="title-bar-dots">
                                <div class="dot dot-red"></div>
                                <div class="dot dot-yellow"></div>
                                <div class="dot dot-green"></div>
                            </div>
                            <span class="title-bar-text">PhotoReel</span>
                            <i data-lucide="image" class="text-lime-400 w-4 h-4"></i>
                        </div>
                         <div class="flex-grow overflow-y-auto p-3 h-0">
                             <div class="grid grid-cols-2 gap-3">
                                <!-- Hardcoded local images. The JS will add the others. -->
                                <div class="w-full h-full cursor-none" onclick="openLightbox('./robloxwnat.jpg')">
                                    <img src="./robloxwnat.jpg" alt="Gallery Photo 1" class="w-full h-full object-cover rounded-md border-2 border-gray-600 hover:border-[var(--hot-pink)] transition-all duration-200">
                                </div>
                                <div class="w-full h-full cursor-none" onclick="openLightbox('./nat.jpg')">
                                    <img src="./nat.jpg" alt="Gallery Photo 2" class="w-full h-full object-cover rounded-md border-2 border-gray-600 hover:border-[var(--hot-pink)] transition-all duration-200">
                                </div>
                             </div>
                         </div>
                    </div>

                    <!-- ====== 5. MUSIC APP ====== -->
                    <div id="app-music" class="app-window hidden">
                         <div class="title-bar">
                             <div class="title-bar-dots">
                                <div class="dot dot-red"></div>
                                <div class="dot dot-yellow"></div>
                                <div class="dot dot-green"></div>
                            </div>
                            <span class="title-bar-text">BeatBox</span>
                            <button id="playlist-toggle-button" class="bg-transparent border-none text-lime-400">
                               <i data-lucide="list-music" class="w-5 h-5"></i>
                            </button>
                        </div>
                        <div class="flex-grow relative">
                            <div class="p-4 flex flex-col items-center justify-center text-center h-full">
                                <img id="music-album-art" src="https://placehold.co/200x200/00529B/ffffff?text=Song" alt="Album Art" class="w-40 h-40 rounded-md mb-4 border-4 border-gray-600">
                                <h2 id="music-title" class="text-lg text-lime-400">Song Title</h2>
                                <p id="music-artist" class="text-sm text-gray-400 mb-4">Artist Name</p>

                                <div class="w-full max-w-xs">
                                    <input type="range" id="music-progress" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-none" value="0">
                                    <div class="flex justify-between text-xs text-gray-400 mt-1">
                                        <span id="music-current-time">0:00</span>
                                        <span id="music-duration">0:00</span>
                                    </div>
                                </div>

                                <div class="flex items-center gap-6 mt-4">
                                    <button id="music-prev" class="text-gray-400 hover:text-white"><i data-lucide="skip-back" class="w-8 h-8"></i></button>
                                    <button id="music-play" class="bg-lime-400 text-black w-16 h-16 rounded-full flex items-center justify-center shadow-lg shadow-blue-900">
                                        <i data-lucide="play" id="play-icon" class="w-8 h-8 fill-black"></i>
                                        <i data-lucide="pause" id="pause-icon" class="w-8 h-8 fill-black hidden"></i>
                                    </button>
                                    <button id="music-next" class="text-gray-400 hover:text-white"><i data-lucide="skip-forward" class="w-8 h-8"></i></button>
                                </div>
                            </div>
                            
                            <div id="music-playlist-overlay" class="absolute inset-0 bg-black/90 backdrop-blur-sm p-3 flex-col hidden opacity-0">
                                <div class="flex justify-between items-center mb-2 flex-shrink-0">
                                     <h3 class="text-lime-400 text-sm">PLAYLIST</h3>
                                     <button id="close-playlist-button"><i data-lucide="x" class="w-5 h-5"></i></button>
                                </div>
                                <ul id="music-playlist-list" class="flex-grow overflow-y-auto list-none p-0 m-0">
                                    <!-- Playlist items will be populated by JS -->
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ====== 6. COUNTDOWN APP ====== -->
                    <div id="app-countdown" class="app-window hidden">
                        <div class="title-bar">
                            <div class="title-bar-dots">
                                <div class="dot dot-red"></div>
                                <div class="dot dot-yellow"></div>
                                <div class="dot dot-green"></div>
                            </div>
                            <span class="title-bar-text">TimeKeep</span>
                            <i data-lucide="clock" class="text-lime-400 w-4 h-4"></i>
                        </div>
                        <div class="p-4 flex flex-col items-center justify-around flex-grow text-center text-lime-400">
                           <div class="border-2 border-lime-400 p-2 rounded-md">
                                <p class="text-xs mb-1">CURRENT TIME</p>
                                <div id="digital-clock" class="text-4xl" style="text-shadow: 0 0 10px var(--green-glow-color);">12:00:00</div>
                                <div id="current-date" class="text-xs"></div>
                           </div>
                           <div class="w-full">
                                <p class="text-xs mb-2">COUNTDOWN TO BIRTHDAY</p>
                                <div class="grid grid-cols-4 gap-2 text-center">
                                    <div><div id="days" class="text-3xl bg-gray-800 p-2 rounded">00</div><div class="text-xs mt-1">Days</div></div>
                                    <div><div id="hours" class="text-3xl bg-gray-800 p-2 rounded">00</div><div class="text-xs mt-1">Hours</div></div>
                                    <div><div id="minutes" class="text-3xl bg-gray-800 p-2 rounded">00</div><div class="text-xs mt-1">Mins</div></div>
                                    <div><div id="seconds" class="text-3xl bg-gray-800 p-2 rounded">00</div><div class="text-xs mt-1">Secs</div></div>
                                </div>
                           </div>
                           <p id="countdown-complete" class="text-2xl hidden" style="text-shadow: 0 0 10px var(--green-glow-color);">🎉 HAPPY BIRTHDAY! 🎉</p>
                        </div>
                    </div>

                    <!-- ====== 7. GAME APP ====== -->
                    <div id="app-game" class="app-window hidden">
                         <div class="title-bar">
                             <div class="title-bar-dots">
                                <div class="dot dot-red"></div>
                                <div class="dot dot-yellow"></div>
                                <div class="dot dot-green"></div>
                            </div>
                            <span class="title-bar-text">StarBlaster</span>
                            <i data-lucide="gamepad-2" class="text-lime-400 w-4 h-4"></i>
                        </div>
                        <div class="flex-grow relative bg-black">
                            <canvas id="game-canvas"></canvas>
                             <div id="game-start-screen" class="absolute inset-0 bg-black bg-opacity-80 flex flex-col items-center justify-center text-center p-4">
                                <h2 class="text-2xl text-lime-400 mb-4">STAR BLASTER</h2>
                                <p class="text-white mb-6">Destroy the enemies!</p>
                                <button id="start-game-button" class="pixel-button rounded-sm">START GAME</button>
                             </div>
                             <div id="game-over-screen" class="absolute inset-0 bg-black bg-opacity-80 flex-col items-center justify-center text-center p-4 hidden">
                                <h2 class="text-2xl text-red-500 mb-4">GAME OVER</h2>
                                <p class="text-white mb-2">Final Score: <span id="final-score">0</span></p>
                                <button id="restart-game-button" class="pixel-button rounded-sm">RESTART</button>
                             </div>
                             <!-- ADDED: On-screen controls for mobile -->
                            <div id="touch-controls" class="absolute bottom-0 left-0 right-0 p-4 flex justify-between items-center hidden">
                                <button id="move-left-btn" class="p-4 bg-white/20 rounded-full text-white active:bg-white/40">
                                    <i data-lucide="arrow-left" class="w-8 h-8 pointer-events-none"></i>
                                </button>
                                <button id="shoot-btn" class="p-6 bg-red-500/50 rounded-full text-white active:bg-red-500/70">
                                    <i data-lucide="crosshair" class="w-10 h-10 pointer-events-none"></i>
                                </button>
                                <button id="move-right-btn" class="p-4 bg-white/20 rounded-full text-white active:bg-white/40">
                                    <i data-lucide="arrow-right" class="w-8 h-8 pointer-events-none"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- ====== BOTTOM NAVIGATION ====== -->
                <nav id="bottom-nav">
                    <div id="nav-notes" class="nav-icon active" data-app="notes">
                        <i data-lucide="file-text" class="w-7 h-7"></i>
                    </div>
                    <div id="nav-message" class="nav-icon" data-app="message">
                        <i data-lucide="message-square" class="w-7 h-7"></i>
                    </div>
                    <div id="nav-gallery" class="nav-icon" data-app="gallery">
                        <i data-lucide="image" class="w-7 h-7"></i>
                    </div>
                    <div id="nav-music" class="nav-icon" data-app="music">
                        <i data-lucide="music" class="w-7 h-7"></i>
                    </div>
                    <div id="nav-countdown" class="nav-icon" data-app="countdown">
                        <i data-lucide="clock" class="w-7 h-7"></i>
                    </div>
                    <div id="nav-game" class="nav-icon" data-app="game">
                         <i data-lucide="activity" class="w-7 h-7"></i>
                    </div>
                </nav>
            </div>
        </div>
    </div>
    
    <!-- Audio element for the music player -->
    <audio id="audio-player"></audio>
    
    <!-- ====== ADDED: Gallery Lightbox/Modal ====== -->
    <div id="gallery-lightbox" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 hidden z-50 transition-opacity duration-300 opacity-0">
        <img id="lightbox-img" src="" alt="Full size view" class="max-w-full max-h-full object-contain rounded-lg shadow-2xl transition-transform duration-300 scale-95">
        <button id="close-lightbox" class="absolute top-5 right-5 text-white opacity-80 hover:opacity-100">
            <i data-lucide="x-circle" class="w-10 h-10"></i>
        </button>
    </div>

    <!-- GEMINI API: Loading Modal -->
    <div id="loading-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex-col items-center justify-center p-4 hidden z-50">
        <div class="text-lime-400 text-lg mb-4" id="loading-text">Generating...</div>
        <div class="w-16 h-16 border-4 border-lime-400 border-t-transparent rounded-full animate-spin"></div>
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // ===================================================================================
        // ====== ⚙️ CUSTOMIZATION AREA ⚙️ ======
        // ====== Edit the values below to personalize the website! ======
        // ===================================================================================
        const CONFIG = {
            // Recipient's Name
            recipientName: "My Love",

            // Your Name
            senderName: "Your Secret Admirer",
            
            // Birthday Date (YYYY, MM-1, DD) - e.g., for Sept 5, use (2025, 8, 5)
            birthdayDate: new Date(2025, 8, 5), // Month is 0-indexed (0=Jan, 8=Sept)
            
            // The main message in the "Notes" app
            birthdayMessage: "Dear Beautiful Soul,\n\nAnother year has painted itself across the canvas of your life, each stroke a highlight, each moment a gift of time. Today we celebrate not just your birth, but the light you bring to the world, the laughter that echoes in hearts, and the kindness that never grows old.\n\nThis new chapter of your journey unfolds with endless possibilities. May your dreams dance with reality, creating a beautiful symphony of success. May love bloom endlessly in your heart, touching every soul you encounter. May joy sparkle in every sunrise you witness, and may you always find strength in your own amazing spirit.\n\nHappy Birthday! 🎉",

            // The chat simulation messages in the "Message" app
            chatMessages: [],

            // Image URLs for the gallery. The first two are now in the HTML.
            // The script will add the rest from this list.
            galleryImages: [
                'https://placehold.co/400x400/00529B/black?text=Nightwing+1',
                'https://placehold.co/400x400/007FFF/black?text=Nightwing+2',
            ],

            // Music playlist for the "Music" app
            playlist: [
                {
                    title: "Perfect",
                    artist: "Ed Sheeran",
                    // UPDATED: Album art to match theme
                    albumArt: "https://placehold.co/200x200/00529B/ffffff?text=Perfect",
                    url: "https://files.catbox.moe/etb7mk.mp3",
                },
                {
                    title: "A Thousand Years",
                    artist: "Christina Perri",
                    url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3",
                    albumArt: "https://placehold.co/200x200/48dbfb/ffffff?text=A+Thousand+Years"
                },
                {
                    title: "I Will Always Love You",
                    artist: "Whitney Houston",
                    url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3",
                    albumArt: "https://placehold.co/200x200/f368e0/ffffff?text=I+Will+Always"
                }
            ]
        };
        // ===================================================================================
        // ====== END OF CUSTOMIZATION AREA ======
        // ===================================================================================


        // --- Initialize Lucide Icons ---
        lucide.createIcons();

        // --- Heart Cursor Logic (UPDATED) ---
        const heartCursor = document.getElementById('heart-cursor');
        window.addEventListener('mousemove', (e) => {
            heartCursor.style.left = e.clientX + 'px';
            heartCursor.style.top = e.clientY + 'px';
        });

        // --- Element Selectors ---
        const unlockScreen = document.getElementById('unlock-screen');
        const openButton = document.getElementById('open-button');
        const mainContent = document.getElementById('main-content');
        const bottomNav = document.getElementById('bottom-nav');
        const galleryLightbox = document.getElementById('gallery-lightbox');
        const lightboxImg = document.getElementById('lightbox-img');
        const closeLightboxBtn = document.getElementById('close-lightbox');
        const loadingModal = document.getElementById('loading-modal');
        const loadingText = document.getElementById('loading-text');

        // --- Apply Customizations ---
        document.querySelector('#unlock-recipient').textContent = CONFIG.recipientName;
        document.querySelector('#unlock-sender').textContent = CONFIG.senderName;
        // UPDATED: Date format to Indonesian
        const bdayDateFormatted = CONFIG.birthdayDate.toLocaleDateString('id-ID', { year: 'numeric', month: 'long', day: 'numeric' });
        document.querySelector('#unlock-date').textContent = bdayDateFormatted;

        // --- Unlock Logic ---
        openButton.addEventListener('click', () => {
            unlockScreen.style.transition = 'opacity 0.5s ease';
            unlockScreen.style.opacity = '0';
            
            playTrack();

            setTimeout(() => {
                unlockScreen.classList.add('hidden');
                mainContent.classList.remove('hidden');
                mainContent.classList.add('flex');
                initNotesApp();
            }, 500);
        });

        // --- App Navigation Logic ---
        const apps = document.querySelectorAll('.app-window');
        const navIcons = document.querySelectorAll('.nav-icon');
        let activeApp = 'notes';
        let isChatInitialized = false;
        let isGalleryInitialized = false;

        function switchApp(appName) {
            apps.forEach(app => app.id === `app-${appName}` ? app.classList.remove('hidden') : app.classList.add('hidden'));
            navIcons.forEach(icon => icon.id === `nav-${appName}` ? icon.classList.add('active') : icon.classList.remove('active'));
            activeApp = appName;
            
            if (activeApp === 'message' && !isChatInitialized) { initMessageApp(); isChatInitialized = true; }
            if (activeApp === 'gallery' && !isGalleryInitialized) { initGalleryApp(); isGalleryInitialized = true; }
            if (activeApp === 'countdown') startCountdown();
            if (activeApp === 'game') initGameApp();
        }

        bottomNav.addEventListener('click', (e) => {
            const navButton = e.target.closest('.nav-icon');
            if (navButton?.dataset.app) switchApp(navButton.dataset.app);
        });
        
        // --- Notes App ---
        const notesContent = document.getElementById('notes-content');
        const listenNotesBtn = document.getElementById('listen-notes-button');
        const rewriteNotesBtn = document.getElementById('rewrite-notes-button');
        let typewriterTimeout;

        function typeWriter(text, i = 0) {
            if (i < text.length) {
                notesContent.innerHTML = text.substring(0, i + 1).replace(/\n/g, '<br>') + '<span class="cursor"></span>';
                typewriterTimeout = setTimeout(() => typeWriter(text, i + 1), 50);
            } else {
                notesContent.querySelector('.cursor')?.remove();
            }
        }
        
        function initNotesApp() {
             typeWriter(CONFIG.birthdayMessage);
        }

        // --- Message App ---
        const messageList = document.getElementById('message-list');
        const chatInput = document.getElementById('chat-input');
        const chatSendButton = document.getElementById('chat-send-button');
        const sleep = ms => new Promise(res => setTimeout(res, ms));
        const fixedReplies = ["Hai sayang!", "Happy birthday to you, my love! ❤️🎂", "Wishing you all the best things in life."];
        let replyCounter = 0;

        function addChatMessage(from, text) {
            const msgDiv = document.createElement('div');
            // UPDATED: Bot bubble color changed from gray to dark blue
            msgDiv.className = `flex items-end gap-2 max-w-[80%] opacity-0 transition-opacity duration-500 ${from === 'me' ? 'self-start' : 'self-end'}`;
            msgDiv.innerHTML = from === 'me'
                ? `<div class="w-6 h-6 rounded-full bg-slate-700 flex-shrink-0"></div><div class="bg-slate-800 p-2 rounded-lg rounded-bl-none"><p class="text-sm">${text}</p></div>`
                : `<div class="bg-blue-600 text-white p-2 rounded-lg rounded-br-none"><p class="text-sm">${text}</p></div><div class="w-6 h-6 rounded-full bg-blue-400 flex-shrink-0"></div>`;
            messageList.appendChild(msgDiv);
            setTimeout(() => msgDiv.classList.remove('opacity-0'), 50);
            messageList.scrollTop = messageList.scrollHeight;
        }
        
        async function handleSendMessage() {
            const text = chatInput.value.trim();
            if (text === '') return;
            addChatMessage('you', text);
            chatInput.value = '';
            chatInput.disabled = true;
            chatSendButton.disabled = true;
            if (replyCounter < fixedReplies.length) {
                await sleep(1000);
                addChatMessage('me', fixedReplies[replyCounter]);
                replyCounter++;
            }
            chatInput.disabled = false;
            chatSendButton.disabled = false;
            chatInput.focus();
        }

        function initMessageApp() {
            chatSendButton.addEventListener('click', handleSendMessage);
            chatInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') { e.preventDefault(); handleSendMessage(); } });
            chatInput.disabled = false;
            chatSendButton.disabled = false;
            chatInput.placeholder = 'Type your message...';
            chatInput.focus();
        }
        
        // --- Gallery App ---
        function initGalleryApp() {
            const galleryGrid = document.querySelector('#app-gallery .grid');
            CONFIG.galleryImages.forEach(url => {
                const imgContainer = document.createElement('div');
                imgContainer.className = "w-full h-full cursor-none";
                // UPDATED: Fixed hover border color
                imgContainer.innerHTML = `<img src="${url}" alt="Gallery Photo" class="w-full h-full object-cover rounded-md border-2 border-gray-600 hover:border-[var(--hot-pink)] transition-all duration-200">`;
                imgContainer.addEventListener('click', () => openLightbox(url));
                galleryGrid.appendChild(imgContainer);
            });
        }
        
        // --- Lightbox Logic ---
        window.openLightbox = function(url) {
            lightboxImg.src = url;
            galleryLightbox.classList.remove('hidden');
            setTimeout(() => {
                galleryLightbox.classList.remove('opacity-0');
                lightboxImg.classList.remove('scale-95');
            }, 10);
        }
        
        function closeLightbox() {
            galleryLightbox.classList.add('opacity-0');
            lightboxImg.classList.add('scale-95');
            setTimeout(() => {
                galleryLightbox.classList.add('hidden');
                lightboxImg.src = "";
            }, 300);
        }
        closeLightboxBtn.addEventListener('click', closeLightbox);
        galleryLightbox.addEventListener('click', (e) => { if (e.target === galleryLightbox) closeLightbox(); });

        // --- Music App ---
        const audioPlayer = document.getElementById('audio-player');
        const playBtn = document.getElementById('music-play');
        const prevBtn = document.getElementById('music-prev');
        const nextBtn = document.getElementById('music-next');
        const progress = document.getElementById('music-progress');
        const currentTimeEl = document.getElementById('music-current-time');
        const durationEl = document.getElementById('music-duration');
        const titleEl = document.getElementById('music-title');
        const artistEl = document.getElementById('music-artist');
        const albumArtEl = document.getElementById('music-album-art');
        const playIcon = document.getElementById('play-icon');
        const pauseIcon = document.getElementById('pause-icon');
        const playlistToggleButton = document.getElementById('playlist-toggle-button');
        const closePlaylistButton = document.getElementById('close-playlist-button');
        const musicPlaylistOverlay = document.getElementById('music-playlist-overlay');
        const musicPlaylistList = document.getElementById('music-playlist-list');
        let currentTrackIndex = 0;

        function loadTrack(index, shouldPlay = false) {
            currentTrackIndex = index;
            const track = CONFIG.playlist[index];
            audioPlayer.src = track.url;
            titleEl.textContent = track.title;
            artistEl.textContent = track.artist;
            albumArtEl.src = track.albumArt;
            updatePlaylistUI();
            if (shouldPlay) audioPlayer.oncanplaythrough = () => playTrack();
        }
        function playTrack() {
            audioPlayer.play().then(() => {
                playIcon.classList.add('hidden');
                pauseIcon.classList.remove('hidden');
            }).catch(error => console.error("Audio playback error:", error));
        }
        function pauseTrack() {
            audioPlayer.pause();
            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');
        }
        function populatePlaylist() {
            musicPlaylistList.innerHTML = '';
            CONFIG.playlist.forEach((song, index) => {
                const li = document.createElement('li');
                li.className = 'p-2 border-b border-gray-700 cursor-none';
                li.dataset.index = index;
                li.innerHTML = `<div>${song.title}</div><div class="artist">${song.artist}</div>`;
                musicPlaylistList.appendChild(li);
            });
            updatePlaylistUI();
        }
        function updatePlaylistUI() {
             musicPlaylistList.querySelectorAll('li').forEach((li, index) => li.classList.toggle('active', index === currentTrackIndex));
        }
        playlistToggleButton.addEventListener('click', () => {
            musicPlaylistOverlay.classList.remove('hidden');
            setTimeout(() => musicPlaylistOverlay.classList.remove('opacity-0'), 10);
        });
        closePlaylistButton.addEventListener('click', () => {
            musicPlaylistOverlay.classList.add('opacity-0');
            setTimeout(() => musicPlaylistOverlay.classList.add('hidden'), 300);
        });
        musicPlaylistList.addEventListener('click', (e) => {
            const li = e.target.closest('li');
            if (li?.dataset.index) {
                loadTrack(parseInt(li.dataset.index), true);
                closePlaylistButton.click();
            }
        });
        playBtn.addEventListener('click', () => (audioPlayer.paused ? playTrack() : pauseTrack()));
        nextBtn.addEventListener('click', () => loadTrack((currentTrackIndex + 1) % CONFIG.playlist.length, true));
        prevBtn.addEventListener('click', () => loadTrack((currentTrackIndex - 1 + CONFIG.playlist.length) % CONFIG.playlist.length, true));
        audioPlayer.addEventListener('timeupdate', () => {
            const { currentTime, duration } = audioPlayer;
            progress.value = (currentTime / duration) * 100 || 0;
            currentTimeEl.textContent = formatTime(currentTime);
        });
        audioPlayer.addEventListener('loadedmetadata', () => { durationEl.textContent = formatTime(audioPlayer.duration); });
        audioPlayer.addEventListener('ended', () => nextBtn.click());
        progress.addEventListener('input', () => { audioPlayer.currentTime = (progress.value / 100) * audioPlayer.duration; });
        function formatTime(seconds) {
            const min = Math.floor(seconds / 60);
            const sec = Math.floor(seconds % 60);
            return `${min}:${sec < 10 ? '0' : ''}${sec}`;
        }
        loadTrack(currentTrackIndex);
        populatePlaylist();
        
        // --- Countdown App (UPDATED) ---
        const daysEl = document.getElementById('days'), hoursEl = document.getElementById('hours'), minutesEl = document.getElementById('minutes'), secondsEl = document.getElementById('seconds'), digitalClockEl = document.getElementById('digital-clock'), currentDateEl = document.getElementById('current-date'), countdownCompleteEl = document.getElementById('countdown-complete');
        let countdownInterval;
        function startCountdown() {
            if (countdownInterval) clearInterval(countdownInterval);
            function update() {
                const now = new Date();
                // Changed to Indonesian locale
                digitalClockEl.textContent = now.toLocaleTimeString('id-ID');
                currentDateEl.textContent = now.toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                const distance = CONFIG.birthdayDate.getTime() - now.getTime();
                if (distance < 0) {
                    clearInterval(countdownInterval);
                    countdownCompleteEl.classList.remove('hidden');
                    document.querySelector('#app-countdown .grid').classList.add('hidden');
                    return;
                }
                daysEl.textContent = Math.floor(distance / 864e5).toString().padStart(2, '0');
                hoursEl.textContent = Math.floor((distance % 864e5) / 36e5).toString().padStart(2, '0');
                minutesEl.textContent = Math.floor((distance % 36e5) / 6e4).toString().padStart(2, '0');
                secondsEl.textContent = Math.floor((distance % 6e4) / 1000).toString().padStart(2, '0');
            }
            update();
            countdownInterval = setInterval(update, 1000);
        }

        // --- Game App (UPDATED FOR MOBILE) ---
        const canvas = document.getElementById('game-canvas'), ctx = canvas.getContext('2d'), startScreen = document.getElementById('game-start-screen'), gameOverScreen = document.getElementById('game-over-screen'), startButton = document.getElementById('start-game-button'), restartButton = document.getElementById('restart-game-button'), finalScoreEl = document.getElementById('final-score');
        const touchControls = document.getElementById('touch-controls');
        const moveLeftBtn = document.getElementById('move-left-btn');
        const moveRightBtn = document.getElementById('move-right-btn');
        const shootBtn = document.getElementById('shoot-btn');
        let player, bullets, enemies, score, lives, gameInterval = null, keys = {};
        function initGameApp() { const p = canvas.parentElement; canvas.width = p.clientWidth; canvas.height = p.clientHeight; }
        function setupGame() { score = 0; lives = 3; player = { x: canvas.width/2 - 15, y: canvas.height - 100, width: 30, height: 20, speed: 5 }; bullets = []; enemies = []; spawnEnemy(); }
        function spawnEnemy() { const s = 20 + Math.random() * 10, x = Math.random() * (canvas.width - s); enemies.push({ x: x, y: -s, width: s, height: s, speed: 1 + Math.random() * 2 }); }
        function gameLoop() { update(); draw(); }
        function update() {
            if (keys['ArrowLeft'] && player.x > 0) player.x -= player.speed;
            if (keys['ArrowRight'] && player.x < canvas.width - player.width) player.x += player.speed;
            bullets.forEach((b, bi) => { b.y -= b.speed; if (b.y < 0) bullets.splice(bi, 1); enemies.forEach((e, ei) => { if (b.x < e.x + e.width && b.x + b.width > e.x && b.y < e.y + e.height && b.y + b.height > e.y) { if(bullets[bi]) bullets.splice(bi, 1); enemies.splice(ei, 1); score += 10; spawnEnemy(); } }); });
            enemies.forEach((e, i) => { e.y += e.speed; if (e.y > canvas.height) { enemies.splice(i, 1); lives--; spawnEnemy(); } if (player.x < e.x + e.width && player.x + player.width > e.x && player.y < e.y + e.height && player.y + player.height > e.y) { lives--; enemies.splice(i, 1); spawnEnemy(); } });
            if (lives <= 0) gameOver();
        }
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#007FFF'; ctx.fillRect(player.x, player.y, player.width, player.height);
            ctx.fillStyle = '#EAEAEA'; bullets.forEach(b => ctx.fillRect(b.x, b.y, b.width, b.height));
            ctx.fillStyle = 'red'; enemies.forEach(e => ctx.fillRect(e.x, e.y, e.width, e.height));
            ctx.fillStyle = 'white'; ctx.font = "12px 'Press Start 2P'"; ctx.fillText(`Score: ${score}`, 10, 20); 
            ctx.fillStyle = '#ff5f56';
            for (let i = 0; i < lives; i++) {
                const heartX = canvas.width - 30 - (i * 25); const heartY = 10; const s = 15;
                ctx.beginPath(); ctx.moveTo(heartX, heartY + s/4); ctx.quadraticCurveTo(heartX, heartY, heartX + s/4, heartY); ctx.quadraticCurveTo(heartX + s/2, heartY, heartX + s/2, heartY + s/4); ctx.quadraticCurveTo(heartX + s/2, heartY, heartX + 3*s/4, heartY); ctx.quadraticCurveTo(heartX + s, heartY, heartX + s, heartY + s/4); ctx.quadraticCurveTo(heartX + s, heartY + s/2, heartX + 3*s/4, heartY + 3*s/4); ctx.lineTo(heartX + s/2, heartY + s); ctx.lineTo(heartX + s/4, heartY + 3*s/4); ctx.quadraticCurveTo(heartX, heartY + s/2, heartX, heartY + s/4); ctx.closePath(); ctx.fill();
            }
        }
        function shoot() { bullets.push({ x: player.x + player.width/2 - 2.5, y: player.y, width: 5, height: 10, speed: 7 }); }
        function startGame() { if(gameInterval) return; startScreen.classList.add('hidden'); gameOverScreen.classList.add('hidden'); touchControls.classList.remove('hidden'); setupGame(); gameInterval = setInterval(gameLoop, 1000/60); }
        function gameOver() { clearInterval(gameInterval); gameInterval = null; gameOverScreen.classList.remove('hidden'); gameOverScreen.classList.add('flex'); touchControls.classList.add('hidden'); }
        startButton.addEventListener('click', startGame);
        restartButton.addEventListener('click', startGame);
        window.addEventListener('keydown', (e) => { keys[e.code] = true; if (e.code === 'Space' && activeApp === 'game' && gameInterval) { e.preventDefault(); shoot(); } });
        window.addEventListener('keyup', (e) => { keys[e.code] = false; });
        
        // --- Touch Control Listeners ---
        canvas.addEventListener('touchstart', e => e.preventDefault(), { passive: false });
        moveLeftBtn.addEventListener('touchstart', (e) => { e.preventDefault(); keys['ArrowLeft'] = true; }, { passive: false });
        moveLeftBtn.addEventListener('touchend', (e) => { e.preventDefault(); keys['ArrowLeft'] = false; });
        moveRightBtn.addEventListener('touchstart', (e) => { e.preventDefault(); keys['ArrowRight'] = true; }, { passive: false });
        moveRightBtn.addEventListener('touchend', (e) => { e.preventDefault(); keys['ArrowRight'] = false; });
        shootBtn.addEventListener('touchstart', (e) => { e.preventDefault(); if (gameInterval) shoot(); }, { passive: false });

        
        // ===================================================================================
        // ====== ✨ GEMINI API FEATURES ✨ ======
        // ===================================================================================

        function showLoading(text) {
            loadingText.textContent = text;
            loadingModal.classList.remove('hidden');
            loadingModal.classList.add('flex');
        }

        function hideLoading() {
            loadingModal.classList.add('hidden');
            loadingModal.classList.remove('flex');
        }
        
        // --- Gemini Text Generation (Rewrite) ---
        rewriteNotesBtn.addEventListener('click', async () => {
            const originalMessage = notesContent.innerText;
            showLoading('Rewriting...');
            
            try {
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                const systemPrompt = "You are a creative writer specializing in heartfelt messages. Rewrite the following birthday wish to be more poetic and emotional, but keep the original sentiment. Keep it to a similar length.";
                const userQuery = `Rewrite this: "${originalMessage}"`;

                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) throw new Error(`API error: ${response.statusText}`);

                const result = await response.json();
                const rewrittenText = result.candidates?.[0]?.content?.parts?.[0]?.text;

                if (rewrittenText) {
                    typeWriter(rewrittenText);
                } else {
                    notesContent.innerText = "Sorry, I couldn't think of a rewrite right now.";
                }
            } catch (error) {
                console.error("Gemini rewrite error:", error);
                notesContent.innerText = "An error occurred. Please try again later.";
            } finally {
                hideLoading();
            }
        });

        // --- Gemini Text-to-Speech (Listen) ---
        listenNotesBtn.addEventListener('click', async () => {
            const messageToRead = notesContent.innerText;
            showLoading('Generating audio...');
            
            try {
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;

                const payload = {
                    contents: [{
                        parts: [{ text: `Read this birthday message aloud in a warm, friendly voice: ${messageToRead}` }]
                    }],
                    generationConfig: {
                        responseModalities: ["AUDIO"],
                    },
                    model: "gemini-2.5-flash-preview-tts"
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) throw new Error(`API error: ${response.statusText}`);
                
                const result = await response.json();
                const audioData = result?.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;

                if (audioData) {
                    const pcmData = base64ToArrayBuffer(audioData);
                    const pcm16 = new Int16Array(pcmData);
                    // Standard sample rate for high-quality speech
                    const wavBlob = pcmToWav(pcm16, 24000); 
                    const audioUrl = URL.createObjectURL(wavBlob);
                    new Audio(audioUrl).play();
                } else {
                    throw new Error("No audio data received from API.");
                }

            } catch (error) {
                console.error("Gemini TTS error:", error);
                alert("Sorry, could not generate audio at this time.");
            } finally {
                hideLoading();
            }
        });


        // --- Audio Conversion Helper Functions ---
        function base64ToArrayBuffer(base64) {
            const binaryString = window.atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }

        function pcmToWav(pcmData, sampleRate) {
            const numChannels = 1;
            const bitsPerSample = 16;
            const byteRate = sampleRate * numChannels * (bitsPerSample / 8);
            const blockAlign = numChannels * (bitsPerSample / 8);
            const dataSize = pcmData.length * (bitsPerSample / 8);
            const buffer = new ArrayBuffer(44 + dataSize);
            const view = new DataView(buffer);

            // RIFF header
            writeString(view, 0, 'RIFF');
            view.setUint32(4, 36 + dataSize, true);
            writeString(view, 8, 'WAVE');
            // fmt chunk
            writeString(view, 12, 'fmt ');
            view.setUint32(16, 16, true); // chunk size
            view.setUint16(20, 1, true); // audio format (1 = PCM)
            view.setUint16(22, numChannels, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, byteRate, true);
            view.setUint16(32, blockAlign, true);
            view.setUint16(34, bitsPerSample, true);
            // data chunk
            writeString(view, 36, 'data');
            view.setUint32(40, dataSize, true);

            // Write PCM data
            for (let i = 0; i < pcmData.length; i++) {
                view.setInt16(44 + i * 2, pcmData[i], true);
            }

            return new Blob([view], { type: 'audio/wav' });
        }
        
        function writeString(view, offset, string) {
            for (let i = 0; i < string.length; i++) {
                view.setUint8(offset + i, string.charCodeAt(i));
            }
        }
    });
    </script>

</body>
</html>

