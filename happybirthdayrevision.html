<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday!</title>
    
    <!-- Tailwind CSS for rapid, responsive styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts for the pixelated aesthetic -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons for modern, clean icons (vanilla JS version) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Custom styles to match the retro theme */
        :root {
            --hot-pink: #ff1e7c;
            --lime-green: #a8ff00;
            --dark-purple: #1e0f33;
            --dark-blue: #0d0d2b;
            --glow-color: rgba(255, 30, 124, 0.5);
            --green-glow-color: rgba(168, 255, 0, 0.5);
        }

        body {
            font-family: 'Press Start 2P', cursive;
            background-color: var(--dark-blue);
            color: white;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 1rem;
            background-image: linear-gradient(to top, #ff9a9e 0%, #fecfef 99%, #fecfef 100%);
            /* UPDATED: Hide the default system cursor */
            cursor: none;
        }

        /* UPDATED: Heart cursor styles for perfect centering */
        #heart-cursor {
            position: fixed;
            width: 30px;
            height: 30px;
            pointer-events: none;
            z-index: 9999;
            /* This transform centers the icon on the cursor's coordinates */
            transform: translate(-50%, -50%);
        }

        #heart-cursor svg {
            width: 100%;
            height: 100%;
            fill: var(--hot-pink);
            stroke: white;
            stroke-width: 1.5;
            filter: drop-shadow(0 0 5px var(--glow-color));
        }
        
        /* ADDED: Styles for floating background images */
        #background-images {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1;
            overflow: hidden;
        }

        .floating-image {
            position: absolute;
            width: 150px;
            height: auto;
            opacity: 0.2;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            animation: float 8s ease-in-out infinite;
        }

        #bg-img-1 { top: 10%; left: 5%; animation-duration: 7s; }
        #bg-img-2 { top: 25%; right: 8%; animation-delay: -4s; animation-duration: 9s; }
        #bg-img-3 { bottom: 15%; left: 12%; animation-delay: -2s; animation-duration: 6s; }
        #bg-img-4 { bottom: 8%; right: 15%; animation-delay: -6s; animation-duration: 8s; }


        /* The main device container */
        #device {
            background-color: var(--hot-pink);
            border: 4px solid #f86ab0;
            border-radius: 40px;
            width: 100%;
            max-width: 420px;
            height: 90vh;
            max-height: 850px;
            box-shadow: 0 0 40px var(--glow-color), inset 0 0 15px rgba(255, 255, 255, 0.3);
            display: flex;
            flex-direction: column;
            padding: 20px;
            transition: all 0.3s ease;
        }

        /* The screen of the device */
        #screen {
            background-color: #000;
            border: 3px solid #333;
            border-radius: 20px;
            flex-grow: 1;
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        
        /* General styling for each "app" window */
        .app-window {
            background-color: #0c0c0c;
            display: flex;
            flex-direction: column;
            height: 100%;
            animation: fadeIn 0.5s ease;
        }
        
        /* Title bar for each app window */
        .title-bar {
            background-color: #222;
            padding: 6px 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 2px solid var(--lime-green);
            flex-shrink: 0;
            user-select: none;
        }
        
        .title-bar-text {
            color: var(--lime-green);
            font-size: 0.7rem;
            text-shadow: 0 0 5px var(--green-glow-color);
        }

        .title-bar-dots {
            display: flex;
            gap: 5px;
        }
        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        .dot-red { background-color: #ff5f56; }
        .dot-yellow { background-color: #ffbd2e; }
        .dot-green { background-color: #27c93f; }

        /* General button styling */
        .pixel-button {
            background-color: var(--lime-green);
            color: #000;
            border: none;
            padding: 10px 15px;
            font-family: 'Press Start 2P', cursive;
            cursor: none; /* Make buttons also use the custom cursor */
            box-shadow: 0 4px 0 #6e9900;
            transition: all 0.1s ease-in-out;
            text-shadow: none;
        }
        .pixel-button:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #6e9900;
        }
        
        /* Bottom navigation bar */
        #bottom-nav {
            display: flex;
            justify-content: space-around;
            background-color: #1a1a1a;
            padding: 10px 0;
            border-top: 2px solid var(--hot-pink);
            flex-shrink: 0;
            box-shadow: 0 -5px 15px var(--glow-color);
        }
        .nav-icon {
            color: #aaa;
            cursor: none; /* Make icons also use the custom cursor */
            transition: all 0.2s ease;
        }
        .nav-icon.active, .nav-icon:hover {
            color: var(--hot-pink);
            transform: scale(1.1);
        }

        /* Typewriter cursor effect */
        .cursor::after {
            content: '_';
            animation: blink 1s step-end infinite;
        }

        /* ADDED: Music Playlist Styles */
        #music-playlist-overlay {
            transition: opacity 0.3s ease-in-out;
        }
        #music-playlist-list li:hover {
            background-color: var(--hot-pink);
        }
        #music-playlist-list li.active {
            color: var(--lime-green);
            font-weight: bold;
        }
        #music-playlist-list li .artist {
            font-size: 0.7rem;
            color: #aaa;
        }

        /* ADDED: Floating animation */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-25px); }
            100% { transform: translateY(0px); }
        }

        @keyframes blink {
            50% { opacity: 0; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        
        /* Scrollbar styling for a retro feel */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #222;
        }
        ::-webkit-scrollbar-thumb {
            background: var(--lime-green);
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #d4ff73;
        }

    </style>
</head>
<body class="bg-gray-900 text-white">
    
    <!-- ADDED: Floating images container -->
    <div id="background-images">
        <img src="birthday1.jpg" alt="Floating background image 1" class="floating-image" id="bg-img-1">
        <img src="birthday2.jpg" alt="Floating background image 2" class="floating-image" id="bg-img-2">
        <img src="birthday3.jpg" alt="Floating background image 3" class="floating-image" id="bg-img-3">
        <img src="birthday4.jpg" alt="Floating background image 4" class="floating-image" id="bg-img-4">
    </div>

    <!-- ADDED: Heart follower cursor -->
    <div id="heart-cursor">
        <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
    </div>


    <!-- The main "device" that holds the entire experience -->
    <div id="device">
        <div id="screen">
            
            <!-- ====== 1. UNLOCK SCREEN (Initial View) ====== -->
            <div id="unlock-screen" class="app-window flex flex-col items-center justify-between p-6 bg-cover bg-center" style="background-image: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://placehold.co/400x800/ff1e7c/0d0d2b?text=Replace\nMe!');">
                <div class="text-center">
                    <h1 id="unlock-title" class="text-2xl md:text-3xl text-white font-bold mb-2" style="text-shadow: 0 0 10px var(--glow-color);">Message For You</h1>
                    <p id="unlock-recipient" class="text-lg text-gray-300">...</p>
                </div>
                
                <div class="text-center">
                    <p id="unlock-date" class="text-sm text-gray-400 mb-6">September 7, 2025</p>
                    <button id="open-button" class="pixel-button text-xl rounded-md flex items-center gap-2">
                        <i data-lucide="mail-open"></i>
                        OPEN
                    </button>
                </div>

                 <div class="w-full text-center">
                    <p class="text-xs text-gray-500">From: <span id="unlock-sender"></span></p>
                </div>
            </div>

            <!-- ====== MAIN CONTENT WRAPPER (Initially Hidden) ====== -->
            <div id="main-content" class="hidden h-full flex-col">
                <div class="flex-grow overflow-y-auto">

                    <!-- ====== 2. NOTES APP ====== -->
                    <div id="app-notes" class="app-window">
                        <div class="title-bar">
                            <div class="title-bar-dots">
                                <div class="dot dot-red"></div>
                                <div class="dot dot-yellow"></div>
                                <div class="dot dot-green"></div>
                            </div>
                            <span class="title-bar-text">BIRTHDAY_WISH.TXT</span>
                            <i data-lucide="chevrons-left" class="text-lime-400 w-4 h-4"></i>
                        </div>
                        <div id="notes-content" class="p-4 text-lime-400 text-sm md:text-base leading-relaxed overflow-y-auto flex-grow h-0">
                           <!-- JS will populate this with a typewriter effect -->
                        </div>
                        <div class="p-2 border-t-2 border-lime-400 flex justify-center gap-4">
                            <button id="play-notes-button" class="pixel-button rounded-sm text-sm">PLAY</button>
                            <button id="skip-notes-button" class="pixel-button bg-gray-500 shadow-gray-700 rounded-sm text-sm">SKIP</button>
                        </div>
                    </div>
                    
                    <!-- ====== 3. MESSAGE APP ====== -->
                    <div id="app-message" class="app-window hidden">
                         <div class="title-bar">
                            <div class="title-bar-dots">
                                <div class="dot dot-red"></div>
                                <div class="dot dot-yellow"></div>
                                <div class="dot dot-green"></div>
                            </div>
                            <span class="title-bar-text">ChatterBox</span>
                            <i data-lucide="message-square" class="text-lime-400 w-4 h-4"></i>
                        </div>
                        <!-- FIXED: Added flex and flex-col to enable proper alignment of messages -->
                        <div id="message-list" class="flex flex-col flex-grow p-3 space-y-4 overflow-y-auto h-0">
                            <!-- Messages will be added here by JS -->
                        </div>
                        <div class="p-2 border-t-2 border-lime-400">
                           <div class="bg-gray-800 border border-lime-400 rounded-md flex items-center p-1">
                                <input type="text" id="chat-input" placeholder="Initializing chat..." disabled class="bg-transparent w-full text-lime-400 text-sm focus:outline-none px-2">
                                <!-- UPDATED: Added send icon to button -->
                                <button id="chat-send-button" class="pixel-button rounded-sm text-sm py-1 px-3" disabled>
                                    <i data-lucide="send-horizontal" class="w-4 h-4"></i>
                                </button>
                           </div>
                        </div>
                    </div>
                    
                    <!-- ====== 4. GALLERY APP (UPDATED) ====== -->
                    <div id="app-gallery" class="app-window hidden">
                        <div class="title-bar">
                            <div class="title-bar-dots">
                                <div class="dot dot-red"></div>
                                <div class="dot dot-yellow"></div>
                                <div class="dot dot-green"></div>
                            </div>
                            <span class="title-bar-text">PhotoReel</span>
                            <i data-lucide="image" class="text-lime-400 w-4 h-4"></i>
                        </div>
                         <div class="flex-grow overflow-y-auto p-3 h-0">
                             <div class="grid grid-cols-2 gap-3">
                                 <!-- Hardcoded local images. The JS will add the others. -->
                                <div class="w-full h-full cursor-pointer" onclick="openLightbox('robloxwnat.jpg')">
                                    <img src="robloxwnat.jpg" alt="Gallery Photo 1" class="w-full h-full object-cover rounded-md border-2 border-gray-600 hover:border-hot-pink transition-all duration-200">
                                </div>
                                <div class="w-full h-full cursor-pointer" onclick="openLightbox('nat.jpg')">
                                    <img src="nat.jpg" alt="Gallery Photo 2" class="w-full h-full object-cover rounded-md border-2 border-gray-600 hover:border-hot-pink transition-all duration-200">
                                </div>
                             </div>
                         </div>
                    </div>

                    <!-- ====== 5. MUSIC APP ====== -->
                    <div id="app-music" class="app-window hidden">
                         <div class="title-bar">
                             <div class="title-bar-dots">
                                <div class="dot dot-red"></div>
                                <div class="dot dot-yellow"></div>
                                <div class="dot dot-green"></div>
                            </div>
                            <span class="title-bar-text">BeatBox</span>
                            <!-- UPDATED: Added Playlist Button -->
                            <button id="playlist-toggle-button" class="bg-transparent border-none text-lime-400">
                               <i data-lucide="list-music" class="w-5 h-5"></i>
                            </button>
                        </div>
                        <!-- UPDATED: Added relative positioning for overlay -->
                        <div class="flex-grow relative">
                            <div class="p-4 flex flex-col items-center justify-center text-center h-full">
                                <img id="music-album-art" src="https://placehold.co/200x200/ff1e7c/ffffff?text=Song" alt="Album Art" class="w-40 h-40 rounded-md mb-4 border-4 border-gray-600">
                                <h2 id="music-title" class="text-lg text-lime-400">Song Title</h2>
                                <p id="music-artist" class="text-sm text-gray-400 mb-4">Artist Name</p>

                                <div class="w-full max-w-xs">
                                    <input type="range" id="music-progress" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer" value="0">
                                    <div class="flex justify-between text-xs text-gray-400 mt-1">
                                        <span id="music-current-time">0:00</span>
                                        <span id="music-duration">0:00</span>
                                    </div>
                                </div>

                                <div class="flex items-center gap-6 mt-4">
                                    <button id="music-prev" class="text-gray-400 hover:text-white"><i data-lucide="skip-back" class="w-8 h-8"></i></button>
                                    <button id="music-play" class="bg-lime-400 text-black w-16 h-16 rounded-full flex items-center justify-center shadow-lg shadow-lime-900">
                                        <i data-lucide="play" id="play-icon" class="w-8 h-8 fill-black"></i>
                                        <i data-lucide="pause" id="pause-icon" class="w-8 h-8 fill-black hidden"></i>
                                    </button>
                                    <button id="music-next" class="text-gray-400 hover:text-white"><i data-lucide="skip-forward" class="w-8 h-8"></i></button>
                                </div>
                            </div>
                            
                            <!-- ADDED: Playlist Overlay -->
                            <div id="music-playlist-overlay" class="absolute inset-0 bg-black/90 backdrop-blur-sm p-3 flex-col hidden opacity-0">
                                <div class="flex justify-between items-center mb-2 flex-shrink-0">
                                     <h3 class="text-lime-400 text-sm">PLAYLIST</h3>
                                     <button id="close-playlist-button"><i data-lucide="x" class="w-5 h-5"></i></button>
                                </div>
                                <ul id="music-playlist-list" class="flex-grow overflow-y-auto list-none p-0 m-0">
                                    <!-- Playlist items will be populated by JS -->
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ====== 6. COUNTDOWN APP ====== -->
                    <div id="app-countdown" class="app-window hidden">
                        <div class="title-bar">
                            <div class="title-bar-dots">
                                <div class="dot dot-red"></div>
                                <div class="dot dot-yellow"></div>
                                <div class="dot dot-green"></div>
                            </div>
                            <span class="title-bar-text">TimeKeep</span>
                            <i data-lucide="clock" class="text-lime-400 w-4 h-4"></i>
                        </div>
                        <div class="p-4 flex flex-col items-center justify-around flex-grow text-center text-lime-400">
                           <div class="border-2 border-lime-400 p-2 rounded-md">
                                <p class="text-xs mb-1">CURRENT TIME</p>
                                <div id="digital-clock" class="text-4xl" style="text-shadow: 0 0 10px var(--green-glow-color);">12:00:00</div>
                                <div id="current-date" class="text-xs"></div>
                           </div>
                           <div class="w-full">
                                <p class="text-xs mb-2">COUNTDOWN TO BIRTHDAY</p>
                                <div class="grid grid-cols-4 gap-2 text-center">
                                    <div><div id="days" class="text-3xl bg-gray-800 p-2 rounded">00</div><div class="text-xs mt-1">Days</div></div>
                                    <div><div id="hours" class="text-3xl bg-gray-800 p-2 rounded">00</div><div class="text-xs mt-1">Hours</div></div>
                                    <div><div id="minutes" class="text-3xl bg-gray-800 p-2 rounded">00</div><div class="text-xs mt-1">Mins</div></div>
                                    <div><div id="seconds" class="text-3xl bg-gray-800 p-2 rounded">00</div><div class="text-xs mt-1">Secs</div></div>
                                </div>
                           </div>
                           <p id="countdown-complete" class="text-2xl hidden" style="text-shadow: 0 0 10px var(--green-glow-color);">🎉 HAPPY BIRTHDAY! 🎉</p>
                        </div>
                    </div>

                    <!-- ====== 7. GAME APP ====== -->
                    <div id="app-game" class="app-window hidden">
                         <div class="title-bar">
                             <div class="title-bar-dots">
                                <div class="dot dot-red"></div>
                                <div class="dot dot-yellow"></div>
                                <div class="dot dot-green"></div>
                            </div>
                            <span class="title-bar-text">StarBlaster</span>
                            <i data-lucide="gamepad-2" class="text-lime-400 w-4 h-4"></i>
                        </div>
                        <div class="flex-grow relative bg-black">
                            <canvas id="game-canvas"></canvas>
                             <div id="game-start-screen" class="absolute inset-0 bg-black bg-opacity-80 flex flex-col items-center justify-center text-center p-4">
                                <h2 class="text-2xl text-lime-400 mb-4">STAR BLASTER</h2>
                                <p class="text-white mb-6">Destroy the enemies!</p>
                                <button id="start-game-button" class="pixel-button rounded-sm">START GAME</button>
                             </div>
                             <div id="game-over-screen" class="absolute inset-0 bg-black bg-opacity-80 flex-col items-center justify-center text-center p-4 hidden">
                                <h2 class="text-2xl text-red-500 mb-4">GAME OVER</h2>
                                <p class="text-white mb-2">Final Score: <span id="final-score">0</span></p>
                                <button id="restart-game-button" class="pixel-button rounded-sm">RESTART</button>
                             </div>
                        </div>
                    </div>

                </div>

                <!-- ====== BOTTOM NAVIGATION ====== -->
                <nav id="bottom-nav">
                    <div id="nav-notes" class="nav-icon active" data-app="notes">
                        <i data-lucide="file-text" class="w-7 h-7"></i>
                    </div>
                    <div id="nav-message" class="nav-icon" data-app="message">
                        <i data-lucide="message-square" class="w-7 h-7"></i>
                    </div>
                    <div id="nav-gallery" class="nav-icon" data-app="gallery">
                        <i data-lucide="image" class="w-7 h-7"></i>
                    </div>
                    <div id="nav-music" class="nav-icon" data-app="music">
                        <i data-lucide="music" class="w-7 h-7"></i>
                    </div>
                    <div id="nav-countdown" class="nav-icon" data-app="countdown">
                        <i data-lucide="clock" class="w-7 h-7"></i>
                    </div>
                    <div id="nav-game" class="nav-icon" data-app="game">
                         <i data-lucide="activity" class="w-7 h-7"></i>
                    </div>
                </nav>
            </div>
        </div>
    </div>
    
    <!-- Audio element for the music player -->
    <audio id="audio-player"></audio>
    
    <!-- ====== ADDED: Gallery Lightbox/Modal ====== -->
    <div id="gallery-lightbox" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 hidden z-50 transition-opacity duration-300 opacity-0">
        <img id="lightbox-img" src="" alt="Full size view" class="max-w-full max-h-full object-contain rounded-lg shadow-2xl transition-transform duration-300 scale-95">
        <button id="close-lightbox" class="absolute top-5 right-5 text-white opacity-80 hover:opacity-100">
            <i data-lucide="x-circle" class="w-10 h-10"></i>
        </button>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // ===================================================================================
        // ====== ⚙️ CUSTOMIZATION AREA ⚙️ ======
        // ====== Edit the values below to personalize the website! ======
        // ===================================================================================
        const CONFIG = {
            // Recipient's Name
            recipientName: "My Love",

            // Your Name
            senderName: "Your Secret Admirer",
            
            // Birthday Date (YYYY, MM-1, DD) - e.g., for July 7, 2025, use (2025, 6, 7)
            birthdayDate: new Date(2025, 8, 7), // Month is 0-indexed (0=Jan, 1=Feb, etc.)
            
            // The main message in the "Notes" app
            birthdayMessage: "Dear Beautiful Soul,\n\nAnother year has painted itself across the canvas of your life, each stroke a highlight, each moment a gift of time. Today we celebrate not just your birth, but the light you bring to the world, the laughter that echoes in hearts, and the kindness that never grows old.\n\nThis new chapter of your journey unfolds with endless possibilities. May your dreams dance with reality, creating a beautiful symphony of success. May love bloom endlessly in your heart, touching every soul you encounter. May joy sparkle in every sunrise you witness, and may you always find strength in your own amazing spirit.\n\nHappy Birthday! 🎉",

            // The chat simulation messages in the "Message" app
            chatMessages: [],

            // Image URLs for the gallery. The first two are now in the HTML.
            // The script will add the rest from this list.
            galleryImages: [
                'https://placehold.co/400x400/1dd1a1/black?text=Foto+5',
                'https://placehold.co/400x400/feca57/black?text=Foto+6',
            ],

            // Music playlist for the "Music" app
            playlist: [
                {
                    title: "Perfect",
                    artist: "Ed Sheeran",
                    url: "https://files.catbox.moe/etb7mk.mp3",
                    albumArt: "https://placehold.co/200x200/ff6b6b/ffffff?text=Perfect"
                },
                {
                    title: "A Thousand Years",
                    artist: "Christina Perri",
                    url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3",
                    albumArt: "https://placehold.co/200x200/48dbfb/ffffff?text=A+Thousand+Years"
                },
                {
                    title: "I Will Always Love You",
                    artist: "Whitney Houston",
                    url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3",
                    albumArt: "https://placehold.co/200x200/f368e0/ffffff?text=I+Will+Always"
                }
            ]
        };
        // ===================================================================================
        // ====== END OF CUSTOMIZATION AREA ======
        // ===================================================================================


        // --- Initialize Lucide Icons ---
        lucide.createIcons();

        // --- Heart Cursor Logic (UPDATED) ---
        const heartCursor = document.getElementById('heart-cursor');
        window.addEventListener('mousemove', (e) => {
            // Use left and top properties for precise positioning
            heartCursor.style.left = e.clientX + 'px';
            heartCursor.style.top = e.clientY + 'px';
        });

        // --- Element Selectors ---
        const unlockScreen = document.getElementById('unlock-screen');
        const openButton = document.getElementById('open-button');
        const mainContent = document.getElementById('main-content');
        const bottomNav = document.getElementById('bottom-nav');
        const galleryLightbox = document.getElementById('gallery-lightbox');
        const lightboxImg = document.getElementById('lightbox-img');
        const closeLightboxBtn = document.getElementById('close-lightbox');

        // --- Apply Customizations ---
        document.querySelector('#unlock-recipient').textContent = CONFIG.recipientName;
        document.querySelector('#unlock-sender').textContent = CONFIG.senderName;
        const bdayDateFormatted = CONFIG.birthdayDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
        document.querySelector('#unlock-date').textContent = bdayDateFormatted;

        // --- Unlock Logic ---
        openButton.addEventListener('click', () => {
            unlockScreen.style.transition = 'opacity 0.5s ease';
            unlockScreen.style.opacity = '0';
            
            playTrack();

            setTimeout(() => {
                unlockScreen.classList.add('hidden');
                mainContent.classList.remove('hidden');
                mainContent.classList.add('flex');
                initNotesApp();
            }, 500);
        });

        // --- App Navigation Logic ---
        const apps = document.querySelectorAll('.app-window');
        const navIcons = document.querySelectorAll('.nav-icon');
        let activeApp = 'notes';
        let isChatInitialized = false;
        let isGalleryInitialized = false; // Add a flag for the gallery

        function switchApp(appName) {
            apps.forEach(app => {
                if (`app-${appName}` === app.id) {
                    app.classList.remove('hidden');
                } else {
                    app.classList.add('hidden');
                }
            });
            navIcons.forEach(icon => {
                if (`nav-${appName}` === icon.id) {
                    icon.classList.add('active');
                } else {
                    icon.classList.remove('active');
                }
            });
            activeApp = appName;
            
            if (activeApp === 'message' && !isChatInitialized) {
                initMessageApp();
                isChatInitialized = true;
            }
            // MODIFIED: Only run gallery init once
            if (activeApp === 'gallery' && !isGalleryInitialized) {
                initGalleryApp();
                isGalleryInitialized = true;
            }
            if (activeApp === 'countdown') startCountdown();
            if (activeApp === 'game') initGameApp();
        }

        bottomNav.addEventListener('click', (e) => {
            const navButton = e.target.closest('.nav-icon');
            if (navButton && navButton.dataset.app) {
                switchApp(navButton.dataset.app);
            }
        });
        
        // --- Notes App ---
        const notesContent = document.getElementById('notes-content');
        const playNotesBtn = document.getElementById('play-notes-button');
        const skipNotesBtn = document.getElementById('skip-notes-button');
        let typewriterTimeout;

        function typeWriter(text, i = 0) {
            if (i < text.length) {
                notesContent.innerHTML = text.substring(0, i + 1).replace(/\n/g, '<br>') + '<span class="cursor"></span>';
                typewriterTimeout = setTimeout(() => typeWriter(text, i + 1), 50);
            } else {
                notesContent.querySelector('.cursor')?.remove();
            }
        }
        
        function initNotesApp() {
            notesContent.innerHTML = '<span class="cursor"></span>';
            playNotesBtn.onclick = () => {
                clearTimeout(typewriterTimeout);
                typeWriter(CONFIG.birthdayMessage);
            };
            skipNotesBtn.onclick = () => {
                clearTimeout(typewriterTimeout);
                notesContent.innerHTML = CONFIG.birthdayMessage.replace(/\n/g, '<br>');
            };
        }

        // --- Message App ---
        const messageList = document.getElementById('message-list');
        const chatInput = document.getElementById('chat-input');
        const chatSendButton = document.getElementById('chat-send-button');
        const sleep = ms => new Promise(res => setTimeout(res, ms));
        const fixedReplies = ["Hai sayang!", "Happy birthday to you, my love! ❤️🎂", "Wishing you all the best things in life."];
        let replyCounter = 0;

        function addChatMessage(from, text) {
            const msgDiv = document.createElement('div');
            msgDiv.classList.add('flex', 'items-end', 'gap-2', 'max-w-[80%]', 'opacity-0', 'transition-opacity', 'duration-500');
            
            if (from === 'me') {
                msgDiv.classList.add('self-start');
                msgDiv.innerHTML = `<div class="w-6 h-6 rounded-full bg-pink-500 flex-shrink-0"></div><div class="bg-gray-700 p-2 rounded-lg rounded-bl-none"><p class="text-sm">${text}</p></div>`;
            } else {
                msgDiv.classList.add('self-end');
                msgDiv.innerHTML = `<div class="bg-lime-400 text-black p-2 rounded-lg rounded-br-none"><p class="text-sm">${text}</p></div><div class="w-6 h-6 rounded-full bg-blue-500 flex-shrink-0"></div>`;
            }
            messageList.appendChild(msgDiv);
            setTimeout(() => msgDiv.classList.remove('opacity-0'), 50);
            messageList.scrollTop = messageList.scrollHeight;
        }
        
        async function handleSendMessage() {
            const text = chatInput.value.trim();
            if (text === '') return;
            addChatMessage('you', text);
            chatInput.value = '';
            chatInput.disabled = true;
            chatSendButton.disabled = true;

            if (replyCounter < fixedReplies.length) {
                await sleep(1000);
                addChatMessage('me', fixedReplies[replyCounter]);
                replyCounter++;
            }
            
            chatInput.disabled = false;
            chatSendButton.disabled = false;
            chatInput.focus();
        }

        function initMessageApp() {
            chatSendButton.addEventListener('click', handleSendMessage);
            chatInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') { e.preventDefault(); handleSendMessage(); } });
            chatInput.disabled = false;
            chatSendButton.disabled = false;
            chatInput.placeholder = 'Type your message...';
            chatInput.focus();
        }
        
        // --- Gallery App (UPDATED) ---
        // This function now only adds images from the CONFIG array, not the hardcoded ones.
        function initGalleryApp() {
            const galleryGrid = document.querySelector('#app-gallery .grid');
            
            CONFIG.galleryImages.forEach(url => {
                const imgContainer = document.createElement('div');
                imgContainer.className = "w-full h-full cursor-pointer";
                imgContainer.innerHTML = `<img src="${url}" alt="Gallery Photo" class="w-full h-full object-cover rounded-md border-2 border-gray-600 hover:border-hot-pink transition-all duration-200">`;
                
                imgContainer.addEventListener('click', () => openLightbox(url));
                
                galleryGrid.appendChild(imgContainer);
            });
        }
        
        // --- Lightbox Logic (UPDATED) ---
        // Made this a global function to be called from HTML onclick
        window.openLightbox = function(url) {
            lightboxImg.src = url;
            galleryLightbox.classList.remove('hidden');
            setTimeout(() => {
                galleryLightbox.classList.remove('opacity-0');
                lightboxImg.classList.remove('scale-95');
            }, 10);
        }
        
        function closeLightbox() {
            galleryLightbox.classList.add('opacity-0');
            lightboxImg.classList.add('scale-95');
            setTimeout(() => {
                galleryLightbox.classList.add('hidden');
                lightboxImg.src = "";
            }, 300);
        }
        closeLightboxBtn.addEventListener('click', closeLightbox);
        galleryLightbox.addEventListener('click', (e) => { if (e.target === galleryLightbox) closeLightbox(); });

        // --- Music App ---
        const audioPlayer = document.getElementById('audio-player');
        const playBtn = document.getElementById('music-play');
        const prevBtn = document.getElementById('music-prev');
        const nextBtn = document.getElementById('music-next');
        const progress = document.getElementById('music-progress');
        const currentTimeEl = document.getElementById('music-current-time');
        const durationEl = document.getElementById('music-duration');
        const titleEl = document.getElementById('music-title');
        const artistEl = document.getElementById('music-artist');
        const albumArtEl = document.getElementById('music-album-art');
        const playIcon = document.getElementById('play-icon');
        const pauseIcon = document.getElementById('pause-icon');
        const playlistToggleButton = document.getElementById('playlist-toggle-button');
        const closePlaylistButton = document.getElementById('close-playlist-button');
        const musicPlaylistOverlay = document.getElementById('music-playlist-overlay');
        const musicPlaylistList = document.getElementById('music-playlist-list');
        let currentTrackIndex = 0;

        function loadTrack(index, shouldPlay = false) {
            currentTrackIndex = index;
            const track = CONFIG.playlist[index];
            audioPlayer.src = track.url;
            titleEl.textContent = track.title;
            artistEl.textContent = track.artist;
            albumArtEl.src = track.albumArt;
            updatePlaylistUI();
            audioPlayer.oncanplaythrough = () => { if (shouldPlay) playTrack(); };
        }
        function playTrack() {
            const playPromise = audioPlayer.play();
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    playIcon.classList.add('hidden');
                    pauseIcon.classList.remove('hidden');
                }).catch(error => console.error("Audio playback error:", error));
            }
        }
        function pauseTrack() {
            audioPlayer.pause();
            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');
        }
        function populatePlaylist() {
            musicPlaylistList.innerHTML = '';
            CONFIG.playlist.forEach((song, index) => {
                const li = document.createElement('li');
                li.className = 'p-2 border-b border-gray-700 cursor-pointer';
                li.dataset.index = index;
                li.innerHTML = `<div>${song.title}</div><div class="artist">${song.artist}</div>`;
                musicPlaylistList.appendChild(li);
            });
            updatePlaylistUI();
        }
        function updatePlaylistUI() {
             musicPlaylistList.querySelectorAll('li').forEach((li, index) => li.classList.toggle('active', index === currentTrackIndex));
        }
        playlistToggleButton.addEventListener('click', () => {
            musicPlaylistOverlay.classList.remove('hidden');
            setTimeout(() => musicPlaylistOverlay.classList.remove('opacity-0'), 10);
        });
        closePlaylistButton.addEventListener('click', () => {
            musicPlaylistOverlay.classList.add('opacity-0');
            setTimeout(() => musicPlaylistOverlay.classList.add('hidden'), 300);
        });
        musicPlaylistList.addEventListener('click', (e) => {
            const li = e.target.closest('li');
            if (li && li.dataset.index) {
                loadTrack(parseInt(li.dataset.index), true);
                closePlaylistButton.click();
            }
        });
        playBtn.addEventListener('click', () => (audioPlayer.paused ? playTrack() : pauseTrack()));
        nextBtn.addEventListener('click', () => loadTrack((currentTrackIndex + 1) % CONFIG.playlist.length, true));
        prevBtn.addEventListener('click', () => loadTrack((currentTrackIndex - 1 + CONFIG.playlist.length) % CONFIG.playlist.length, true));
        audioPlayer.addEventListener('timeupdate', () => {
            const { currentTime, duration } = audioPlayer;
            progress.value = (currentTime / duration) * 100 || 0;
            currentTimeEl.textContent = formatTime(currentTime);
        });
        audioPlayer.addEventListener('loadedmetadata', () => { durationEl.textContent = formatTime(audioPlayer.duration); });
        audioPlayer.addEventListener('ended', () => nextBtn.click());
        progress.addEventListener('input', () => { audioPlayer.currentTime = (progress.value / 100) * audioPlayer.duration; });
        function formatTime(seconds) {
            const min = Math.floor(seconds / 60);
            const sec = Math.floor(seconds % 60);
            return `${min}:${sec < 10 ? '0' : ''}${sec}`;
        }
        loadTrack(currentTrackIndex);
        populatePlaylist();
        
        // --- Countdown App ---
        const daysEl = document.getElementById('days'), hoursEl = document.getElementById('hours'), minutesEl = document.getElementById('minutes'), secondsEl = document.getElementById('seconds'), digitalClockEl = document.getElementById('digital-clock'), currentDateEl = document.getElementById('current-date'), countdownCompleteEl = document.getElementById('countdown-complete');
        let countdownInterval;
        function startCountdown() {
            if (countdownInterval) clearInterval(countdownInterval);
            function update() {
                const now = new Date();
                digitalClockEl.textContent = now.toLocaleTimeString('it-IT');
                currentDateEl.textContent = now.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                const distance = CONFIG.birthdayDate.getTime() - now.getTime();
                if (distance < 0) {
                    clearInterval(countdownInterval);
                    countdownCompleteEl.classList.remove('hidden');
                    document.querySelector('#app-countdown .grid').classList.add('hidden');
                    return;
                }
                daysEl.textContent = Math.floor(distance / 864e5).toString().padStart(2, '0');
                hoursEl.textContent = Math.floor((distance % 864e5) / 36e5).toString().padStart(2, '0');
                minutesEl.textContent = Math.floor((distance % 36e5) / 6e4).toString().padStart(2, '0');
                secondsEl.textContent = Math.floor((distance % 6e4) / 1000).toString().padStart(2, '0');
            }
            update();
            countdownInterval = setInterval(update, 1000);
        }

        // --- Game App ---
        const canvas = document.getElementById('game-canvas'), ctx = canvas.getContext('2d'), startScreen = document.getElementById('game-start-screen'), gameOverScreen = document.getElementById('game-over-screen'), startButton = document.getElementById('start-game-button'), restartButton = document.getElementById('restart-game-button'), finalScoreEl = document.getElementById('final-score');
        let player, bullets, enemies, score, lives, gameInterval = null, keys = {};
        function initGameApp() { const p = canvas.parentElement; canvas.width = p.clientWidth; canvas.height = p.clientHeight; }
        function setupGame() { score = 0; lives = 3; player = { x: canvas.width/2 - 15, y: canvas.height - 40, width: 30, height: 20, speed: 5 }; bullets = []; enemies = []; spawnEnemy(); }
        function spawnEnemy() { const s = 20 + Math.random() * 10, x = Math.random() * (canvas.width - s); enemies.push({ x: x, y: -s, width: s, height: s, speed: 1 + Math.random() * 2 }); }
        function gameLoop() { update(); draw(); }
        function update() {
            if (keys['ArrowLeft'] && player.x > 0) player.x -= player.speed;
            if (keys['ArrowRight'] && player.x < canvas.width - player.width) player.x += player.speed;
            bullets.forEach((b, bi) => { b.y -= b.speed; if (b.y < 0) bullets.splice(bi, 1); enemies.forEach((e, ei) => { if (b.x < e.x + e.width && b.x + b.width > e.x && b.y < e.y + e.height && b.y + b.height > e.y) { if(bullets[bi]) bullets.splice(bi, 1); enemies.splice(ei, 1); score += 10; spawnEnemy(); } }); });
            enemies.forEach((e, i) => { e.y += e.speed; if (e.y > canvas.height) { enemies.splice(i, 1); lives--; spawnEnemy(); } if (player.x < e.x + e.width && player.x + player.width > e.x && player.y < e.y + e.height && player.y + player.height > e.y) { lives--; enemies.splice(i, 1); spawnEnemy(); } });
            if (lives <= 0) gameOver();
        }
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#a8ff00'; ctx.fillRect(player.x, player.y, player.width, player.height);
            ctx.fillStyle = '#ff1e7c'; bullets.forEach(b => ctx.fillRect(b.x, b.y, b.width, b.height));
            ctx.fillStyle = 'red'; enemies.forEach(e => ctx.fillRect(e.x, e.y, e.width, e.height));
            ctx.fillStyle = 'white'; ctx.font = "12px 'Press Start 2P'"; ctx.fillText(`Score: ${score}`, 10, 20); ctx.fillText(`Lives: ${lives}`, canvas.width - 80, 20);
        }
        function shoot() { bullets.push({ x: player.x + player.width/2 - 2.5, y: player.y, width: 5, height: 10, speed: 7 }); }
        function startGame() { if(gameInterval) return; startScreen.classList.add('hidden'); gameOverScreen.classList.add('hidden'); setupGame(); gameInterval = setInterval(gameLoop, 1000/60); }
        function gameOver() { clearInterval(gameInterval); gameInterval = null; gameOverScreen.classList.remove('hidden'); gameOverScreen.classList.add('flex'); finalScoreEl.textContent = score; }
        startButton.addEventListener('click', startGame);
        restartButton.addEventListener('click', startGame);
        window.addEventListener('keydown', (e) => { keys[e.code] = true; if (e.code === 'Space' && activeApp === 'game' && gameInterval) { e.preventDefault(); shoot(); } });
        window.addEventListener('keyup', (e) => { keys[e.code] = false; });
    });
    </script>

</body>
</html>

